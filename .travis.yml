language: bash
env:
  global:
    - TFLINT_VER='v0.7.0'
    - TERRAFORM_VER='0.11.7'
branches:
  only:
  - master
before_install:
  # Install tflint
  - "wget https://github.com/wata727/tflint/releases/download/${TFLINT_VER}/tflint_linux_amd64.zip"
  - "unzip tflint_linux_amd64.zip && chmod +x tflint"
  # Install Terraform
  - "wget https://releases.hashicorp.com/terraform/0.11.7/terraform_${TERRAFORM_VER}_linux_amd64.zip"
  - "unzip terraform_${TERRAFORM_VER}_linux_amd64.zip && chmod +x terraform"
script:
  # Test case
  # 1. tflint
  - "ls -l"
  - "./tflint"
  # 2. terraform init and fmt
  - "scripts/test_terraform.sh"
    
notifications:
  email: false
  slack:
    template:
      - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} by %{author} %{result} in %{duration}"
      - 'Commit message : %{commit_message}'
    rooms:
      secure: "d5lzn87b1LiadF7e8U7mqJL6LvDTsyLBNxiVTygkiqSxxKNoOzl+yANUObO+IaHT92ywOSbF08lWyptdjnL3wd5smDnrL6TJAhOciaem4QYsh5yAEDnwZOQ2A/Ar+VK9A3+ceQXgKwhVBSu3HQYywTQ2PJUlvs9NpuHgWcDS3WQVSCqkcVG2jkCQxCrus5YOU81Pah20DfSJbi973rneSMqDER0kN4ZJ77gjk6dQ4Jf3o3NWiUww2gEvS2QveJn0WBCHKTSN+Ku5bQXxq+HkNDG+KKYwLRGQ9y2lRWDYbs3+NgP3grfQE0nY+peuDhkgx7++eca28ftwZO/bEXd/b9oQLl0Jfo9SpcM200hvQlFvkynLuQXi11bP9ArAM0jRUt8wR8taYpPumfK/vXp6kNYK7+LlUcyKQOJaSHI61R0tNnf869E8IcnH5CiRTX11fG9EsvIfZ/cEiU7C5CX7tCmGfI8mVIWii7hHyDrL++v6n2ZNlgG4/OutZUvySYxiHgniFhzBuJQ9COMj4HOqMwUR3b5g2x8hVnmb/6aTsaTZYl2nf5TAo5z330OY931f+ENKnZ7wqdieWA9oQtFwk7iCdTrnZwBJdskpGuSRs+nQXlmpRHGddPiJjp8KM+d1MBS6eDOLUw+4FsGPQAknfcbbR6hoM7FfyilYeQ0ulH4="
