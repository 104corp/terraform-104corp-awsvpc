language: bash
env:
  global:
    - TFLINT_VER='v0.7.0'
    - TERRAFORM_VER='0.11.7'
branches:
  only:
  - master
before_install:
  # Install tflint
  - "wget https://github.com/wata727/tflint/releases/download/${TFLINT_VER}/tflint_linux_amd64.zip"
  - "unzip tflint_linux_amd64.zip && chmod +x tflint"
  # Install Terraform
  - "wget https://releases.hashicorp.com/terraform/0.11.7/terraform_${TERRAFORM_VER}_linux_amd64.zip"
  - "unzip terraform_${TERRAFORM_VER}_linux_amd64.zip && chmod +x terraform"
script:
  # Test case
  # 1. tflint
  - "ls -l"
  - "./tflint"
  # 2. terraform init and fmt
  - "scripts/test_terraform.sh"
    
notifications:
  email: false
  slack:
    template:
      - "Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch} by %{author} %{result} in %{duration}"
      - 'Commit message : %{commit_message}'
    rooms:
      secure: "okwN34e3Da57flCkRyfJtffAY2AN+jUPMVK28mP6YTW1Y7DRz4GbfLVqxYTBmEDmcoS5WJY1bVficgQAyIda8JAilrGDG1EOlVBAJiC/pCzOO5TKB1h+lJ2ja76Ogr+prIoUYTrnvwdE9u2Ti1lOcUIlg0mbDtBp3YAlOqbJqFS6GRwTfqsMj8ctPtPUZf4ZHvjfpVqq2BZyjduEw9yPtR+LFB3elRxIz0Y4ntcHslVM8FU1CJMTo++8CU0QyW6L/mNmg24eWB+P28sms/yKCgym1NpcC9+PKiPwU0r3BQAsQfd79YJrQTReqkfK0DaKQmqoj6APqubmgVEg1jAkpLeTaYc40kEzXsFRseVV8vFbyGASc8Ib4WkP1uuE8tWeWum4Y6oOcO/yTlnTxFejwjVFNJhqBV3z0uWdILeG9Ni+SED5uzT8Kp5krXY+MJYRHyxEuEsILdrGP4I4zdUcJ50nwXRie0F+AiW+6W1DS2NZzZoC2K28/y3x4reFNWlhoiBYXR3nY9yhXdWaJ28fRzhvbuYqZOA8eZJGnHwrKEjx/wYEmfznOalngIfcNwa63nSPIECqjJ1kKK6RDDEjbc+u+sfs7Z0kTzm9g1HCjoG69Zop4k+RqV4ru7c2jrtWyTk95Pn61LHbGaaJ5fBy0wstQUZYriL112Sa3faAqKY="
